<!-- Parent: ../AGENTS.md -->
<!-- Generated: 2026-02-13 -->

# android/ (Android Implementation)

## Purpose
Android native implementation of the DeviceInfo module in Kotlin. Extends `HybridDeviceInfoSpec` abstract class with 80+ properties/methods using Android platform APIs.

## Key Files

| File | Description |
|------|-------------|
| `src/main/java/com/margelo/nitro/nitrodeviceinfo/DeviceInfo.kt` | Main implementation (~1376 lines). Extends HybridDeviceInfoSpec. |
| `src/main/java/com/margelo/nitro/nitrodeviceinfo/NitroDeviceInfoPackage.kt` | React Native package registration |
| `build.gradle` | Android library build configuration |
| `CMakeLists.txt` | C++ build configuration for JSI/Nitro integration |

## For AI Agents

### Working In This Directory
- `DeviceInfo.kt` extends `HybridDeviceInfoSpec()` (auto-generated by Nitrogen)
- After changing `src/DeviceInfo.nitro.ts`, run `yarn nitrogen` then implement here
- Follow Kotlin conventions from CLAUDE.md: `companion object` at bottom, prefer `runCatching` over `try-catch`, use `use` for Closable resources

**Key Android APIs**:
- `android.os.Build` - Device model, manufacturer, Android version
- `android.content.pm.PackageManager` - App metadata, system features
- `android.app.ActivityManager` - Memory info
- `android.os.BatteryManager` - Battery level, charging state
- `android.media.AudioManager` - Headphone detection
- `android.telephony.TelephonyManager` - Carrier info
- `android.provider.Settings` - Android ID, system settings

**Root Detection** (20+ checks):
- su binaries (8 paths), Magisk, KernelSU, APatch, Busybox
- Build props tampering, superuser apps
- Returns `false` on emulator

**Year Class Calculation** (Facebook algorithm, extended to 2025):
- RAM-based: ≤2GB→2013, ≤4GB→2015, ≤6GB→2017, ≤8GB→2019, ≤12GB→2021, ≤16GB→2023, >16GB→2025

**Caching**: IP address (5s), MAC address (5s), carrier info (5s), year class (indefinite)

### Testing Requirements
- Test on physical device (root detection, cellular, hardware features)
- Test on emulator (emulator detection, stub values)
- Test across Android versions (API 24-34+)
- Test with/without Google Play Services

### Common Patterns
```kotlin
// Sync property
override val deviceId: String get() = Build.MODEL

// Runtime getter
override fun getIsLandscape(): Boolean {
  val dm = context.resources.displayMetrics
  return dm.widthPixels > dm.heightPixels
}

// Async method
override fun getIpAddress(): Promise<String> = Promise.async {
  getIpAddressInternal()
}

// Platform default (iOS-only API)
override val carrierAllowsVOIP: Boolean get() = true
```

## Dependencies

### Internal
- `nitrogen/generated/android/kotlin/.../HybridDeviceInfoSpec.kt` - Abstract class (auto-generated)
- `nitrogen/generated/android/kotlin/.../BatteryState.kt`, `PowerState.kt`, `DeviceType.kt`, `NavigationMode.kt`

### External
- Android SDK (Build, PackageManager, ActivityManager, BatteryManager, AudioManager, TelephonyManager)
- `com.google.android.gms:play-services-base` - GMS detection

<!-- MANUAL: -->
